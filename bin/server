#!/bin/bash


if [[ $EUID -ne 0 ]]; then
    echo "This script must be executed as root"
    exit 1
fi

uid=`id -u vagrant`
cd /vagrant


if [[ $1 == run ]]; then

    if [[ -z $DJANGO_SETTINGS_MODULE || -z $SECRET_KEY ]]; then
        echo '$DJANGO_SETTINGS_MODULE and $SECRET_KEY must be set.'
        echo "Execute 'source bin/setup'"
        exit 1
    fi

    uwsgi --uid $uid --ini uwsgi.ini --pidfile .h/uwsgi.pid

elif [[ $1 =~ "stop reload pause suspend resume" ]]; then
    uwsgi --pidfile .h/uwsgi.pid "--$1"
else
    echo "Unknwon command: $1"
    exit 1
fi
